# Logrotate configuration for Vector Log Hub
# Development/Testing settings with monitoring

# Vector application logs
/var/log/vector/app-*.log {
    daily
    rotate 10
    maxsize 10M
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    sharedscripts
    postrotate
        # Log rotation event for monitoring
        echo "$(date): Rotated Vector app logs - $(ls -lh /var/log/vector/app-*.log* | wc -l) files" >> /var/log/vector/rotation.log
        # Send HUP signal to Vector to reopen log files
        docker kill --signal=HUP vector-log-hub 2>/dev/null || true
    endscript
}

# Vector error logs
/var/log/vector/errors-*.log {
    daily
    rotate 7
    maxsize 5M
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    sharedscripts
    postrotate
        echo "$(date): Rotated Vector error logs - $(ls -lh /var/log/vector/errors-*.log* | wc -l) files" >> /var/log/vector/rotation.log
        docker kill --signal=HUP vector-log-hub 2>/dev/null || true
    endscript
}

# Vector internal logs
/var/log/vector/vector-internal.log {
    daily
    rotate 5
    maxsize 5M
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    postrotate
        echo "$(date): Rotated Vector internal logs" >> /var/log/vector/rotation.log
        docker kill --signal=HUP vector-log-hub 2>/dev/null || true
    endscript
}

# Logrotate monitoring log
/var/log/vector/rotation.log {
    weekly
    rotate 4
    maxsize 1M
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}

# Development/Testing settings:
# - More generous rotation limits for development
# - Larger file sizes for testing workloads
# - Monitor rotation events in rotation.log
# - Total storage: ~100MB maximum
#
# To check if logrotate is working:
# 1. Check rotation.log: cat /var/log/vector/rotation.log
# 2. Test manually: sudo logrotate -f config/logrotate.conf
# 3. Check file timestamps: ls -la /var/log/vector/
# 4. Monitor disk usage: du -sh /var/log/vector/